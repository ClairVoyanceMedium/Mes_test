<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat IA avec Tracking et Assistant Vocal</title>
  <style>
    /* Conteneur gÃ©nÃ©ral du chat avec effet nÃ©on */
    #chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      max-height: 450px;
      display: flex;
      flex-direction: column;
      z-index: 999999;
      font-family: Arial, sans-serif;
      cursor: move;
      transition: transform 0.2s;
    }
    /* Bouton de bascule */
    #chat-toggle {
      width: 60px;
      height: 60px;
      background: linear-gradient(145deg, #FFB6C1, #FF69B4);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(255,105,180,0.7);
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      outline: none;
    }
    #chat-toggle:hover {
      transform: scale(1.05);
    }
    /* Bouton vocal */
    #voice-toggle {
      width: 40px;
      height: 40px;
      background: linear-gradient(145deg, #87CEEB, #5eb6d1);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(135,206,235,0.7);
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 10px;
      transition: transform 0.2s;
      outline: none;
    }
    #voice-toggle:hover {
      transform: scale(1.05);
    }
    #voice-toggle.listening {
      background: #FF4500;
      box-shadow: 0 0 10px #FF4500;
    }
    /* BoÃ®te de dialogue avec contour nÃ©on rose fluo */
    #chat-box {
      background: #111;
      border-radius: 10px;
      flex: 1;
      display: none; /* Remplace hidden pour mieux contrÃ´ler via JS */
      flex-direction: column;
      overflow: hidden;
      margin-top: 10px;
      border: 2px solid #FF1493;
      box-shadow: 0 0 10px #FF1493;
      transition: all 0.3s ease;
    }
    #chat-box.visible {
      display: flex; /* Classe pour montrer le chat */
    }
    /* Zone des messages avec effet fade-in */
    #chat-messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      color: #fff;
    }
    #chat-messages p {
      margin-bottom: 0.5rem;
      line-height: 1.4;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    /* Bulles de messages du bot avec effet nÃ©on rose */
    .bot-message {
      text-align: left;
      color: #fff;
      background: rgba(255,255,255,0.05);
      padding: 0.5rem;
      border-radius: 5px;
      margin-bottom: 0.8rem;
      display: inline-block;
      max-width: 80%;
      border: 2px solid #FF69B4;
      box-shadow: 0 0 8px #FF69B4;
    }
    /* Bulles de messages de l'utilisateur avec effet nÃ©on bleu */
    .user-message {
      text-align: right;
      color: #ffd700;
      margin-bottom: 0.8rem;
      border: 2px solid #AED6F1;
      box-shadow: 0 0 8px #AED6F1;
      padding: 0.5rem;
      border-radius: 5px;
      display: inline-block;
      max-width: 80%;
    }
    /* Formulaire de saisie */
    #chat-form {
      display: flex;
      border-top: 1px solid #333;
      align-items: center;
      padding: 0.5rem;
    }
    #chat-input {
      flex: 1;
      padding: 0.5rem;
      border: none;
      outline: none;
      color: #333;
      border-radius: 5px 0 0 5px;
    }
    #chat-send {
      background: #87CEEB;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      color: #fff;
      font-weight: bold;
      border-radius: 0 5px 5px 0;
      transition: background 0.2s;
    }
    #chat-send:hover {
      background: #5eb6d1;
    }
    @media(max-width: 400px) {
      #chat-container {
        width: 90%;
        right: 5%;
        bottom: 5px;
      }
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <!-- Bouton de bascule du chat -->
    <div style="display: flex; justify-content: flex-end;">
      <button id="chat-toggle" aria-expanded="false" aria-label="Ouvrir le chat">ðŸ’¬</button>
      <button id="voice-toggle" aria-label="Activer/DÃ©sactiver l'assistant vocal">ðŸŽ¤</button>
    </div>
    
    <!-- BoÃ®te de dialogue (initialement masquÃ©e) -->
    <div id="chat-box" role="region" aria-label="Chat IA">
      <div id="chat-messages" aria-live="polite"></div>
      <form id="chat-form" aria-label="Formulaire de saisie pour le Tchat IA">
        <input type="text" id="chat-input" placeholder="Posez votre question..." aria-label="Tapez votre message ici" autocomplete="off">
        <button type="submit" id="chat-send" aria-label="Envoyer votre question">âž¤</button>
      </form>
    </div>
  </div>

  <script>
    // Fonction de tracking (simulÃ©e, peut Ãªtre connectÃ©e Ã  une API)
    function trackClick(label, category = 'Chat', value = null) {
      console.log(`Tracking: Label=${label}, Category=${category}, Value=${value}`);
    }

    // Base de connaissances avec mots multiples
    const knowledgeBase = [
{ question: "Fatigue", answer: "Et si cette fatigue Ã©crasante nâ€™Ã©tait pas un hasard, mais une entitÃ© obscure qui dÃ©vore ton Ã©nergie ? Frederick de ClairvoyanceMedium.com purifie ton aura pour te libÃ©rer â€“ combien de temps te laisseras-tu sombrer ?" },
{ question: "Cauchemars", answer: "Ces cauchemars qui tâ€™assaillent pourraient Ãªtre lâ€™Å“uvre dâ€™une prÃ©sence malÃ©fique ; Frederick chasse ces ombres pour te rendre tes nuits â€“ supporteras-tu encore ces terreurs ?" },
{ question: "Chaos", answer: "Ce chaos qui tâ€™entoure pourrait cacher une malÃ©diction qui brise ton destin ; Frederick rÃ©tablit lâ€™ordre pour te sauver â€“ laisseras-tu la tempÃªte tâ€™emporter ?" },
{ question: "Oppression", answer: "Cette oppression qui tâ€™Ã©touffe pourrait Ãªtre une force sombre qui Ã©crase ton Ã¢me ; Frederick te libÃ¨re de ce joug â€“ combien de temps ploieras-tu sous cette ombre ?" },
{ question: "Sort", answer: "Fatigue, malchance, cauchemars : et si un sort te retenait captif ? Frederick brise ces liens occultes â€“ oseras-tu dÃ©fier cette emprise ?" },
{ question: "Ã‰chec", answer: "Tes Ã©checs rÃ©pÃ©tÃ©s pourraient Ãªtre un sort qui bloque ton chemin ; Frederick ouvre ta voie au succÃ¨s â€“ combien de fois trÃ©bucheras-tu encore ?" },
{ question: "Insomnie", answer: "Ton insomnie pourrait Ãªtre une entitÃ© qui vole ton repos ; Frederick te rend la paix nocturne â€“ jusquâ€™Ã  quand tiendras-tu Ã©veillÃ© ?" },
{ question: "Douleur", answer: "Ces douleurs inexplicables pourraient trahir une attaque occulte ; Frederick te soulage â€“ combien de temps endureras-tu ce feu invisible ?" },
{ question: "Isolement", answer: "Et si ton isolement Ã©tait un sort qui tâ€™arrache aux autres ? Frederick te reconnecte Ã  la lumiÃ¨re â€“ resteras-tu seul dans ce vide ?" },
{ question: "CarriÃ¨re", answer: "Ces obstacles dans ta carriÃ¨re pourraient Ãªtre une malÃ©diction ; Frederick libÃ¨re ton potentiel â€“ laisseras-tu ton avenir professionnel sâ€™Ã©teindre ?" },
{ question: "Malchance", answer: "Ta malchance pourrait Ãªtre un sort qui assombrit ta vie ; Frederick te ramÃ¨ne la chance â€“ combien de coups du sort encaisseras-tu ?" },
{ question: "Amour", answer: "Si lâ€™amour te fuit, un sort pourrait fermer ton cÅ“ur ; Frederick lâ€™ouvre Ã  la tendresse â€“ supporteras-tu encore ce dÃ©sert sentimental ?" },
{ question: "Famille", answer: "Ces tensions dans ton foyer pourraient Ãªtre une ombre occulte ; Frederick apaise ton clan â€“ laisseras-tu ta famille se dÃ©chirer ?" },
{ question: "Enfants", answer: "La peine de tes enfants pourrait rÃ©vÃ©ler une influence sombre ; Frederick purifie leur aura â€“ combien de temps les verras-tu souffrir ?" },
{ question: "Animaux", answer: "Lâ€™agitation de tes animaux pourrait signaler une prÃ©sence obscure ; Frederick restaure la paix â€“ ignoreras-tu leur cri dâ€™alarme ?" },
{ question: "Maison", answer: "Ton foyer oppressant pourrait Ãªtre infestÃ© dâ€™Ã©nergies noires ; Frederick le purifie â€“ vivras-tu encore dans cette prison ?" },
{ question: "Voiture", answer: "Les pannes de ta voiture pourraient Ãªtre un sort ; Frederick la libÃ¨re â€“ risqueras-tu encore ces trajets maudits ?" },
{ question: "PrÃ©sence", answer: "Ce sentiment dâ€™Ãªtre suivi pourrait Ãªtre une entitÃ© malveillante ; Frederick te protÃ¨ge â€“ combien de temps tolÃ©reras-tu cette ombre ?" },
{ question: "Angoisse", answer: "Ton angoisse pourrait Ãªtre un sort qui te ronge ; Frederick te calme â€“ laisseras-tu la peur te dÃ©vorer ?" },
{ question: "IrritabilitÃ©", answer: "Ton irritation pourrait trahir une influence occulte ; Frederick te rend la douceur â€“ combien de temps exploseras-tu encore ?" },
{ question: "Concentration", answer: "Ton esprit brouillÃ© pourrait Ãªtre victime dâ€™un sort ; Frederick te recentre â€“ combien de temps erreras-tu dans ce chaos ?" },
{ question: "MÃ©moire", answer: "Tes pertes de mÃ©moire pourraient Ãªtre un envoÃ»tement ; Frederick te rend ta clartÃ© â€“ oublieras-tu encore ton passÃ© ?" },
{ question: "LignÃ©e", answer: "Un sort ancien pourrait hanter ta lignÃ©e ; Frederick te libÃ¨re de ce poids â€“ laisseras-tu tes ancÃªtres te maudire ?" },
{ question: "Souffrance", answer: "Ta souffrance pourrait Ãªtre une attaque occulte ; Frederick te guÃ©rit â€“ supporteras-tu encore ce tourment ?" },
{ question: "DÃ©connexion", answer: "Ce vide en toi pourrait Ãªtre un sort qui te coupe de ton Ã¢me ; Frederick te reconnecte â€“ resteras-tu perdu dans lâ€™abÃ®me ?" },
{ question: "Aura", answer: "Ton aura ternie pourrait Ãªtre polluÃ©e par lâ€™obscuritÃ© ; Frederick la purifie â€“ laisseras-tu cette ombre tâ€™Ã©teindre ?" },
{ question: "Projets", answer: "Tes rÃªves brisÃ©s pourraient Ãªtre bloquÃ©s par un sort ; Frederick libÃ¨re ton chemin â€“ abandonneras-tu encore tes espoirs ?" },
{ question: "Stress", answer: "Ce stress pourrait Ãªtre une emprise occulte ; Frederick tâ€™apaise â€“ combien de temps tiendras-tu sous cette pression ?" },
{ question: "Vie", answer: "Si ta vie sâ€™assombrit, un sort pourrait la voiler ; Frederick lâ€™illumine â€“ continueras-tu Ã  errer dans ce nÃ©ant ?" },
{ question: "Blocage", answer: "Ces blocages pourraient Ãªtre des chaÃ®nes occultes ; Frederick les brise â€“ combien de temps resteras-tu immobile ?" },
{ question: "Stagnation", answer: "Ta stagnation pourrait Ãªtre un sort qui fige ton Ã¢me ; Frederick te relance â€“ supporteras-tu encore cette paralysie ?" },
{ question: "Humeur", answer: "Tes humeurs sombres pourraient Ãªtre un sort ; Frederick te stabilise â€“ laisseras-tu ces ombres te guider ?" },
{ question: "Vide", answer: "Ce vide pourrait Ãªtre une force qui te draine ; Frederick te remplit de lumiÃ¨re â€“ combien de temps vivras-tu dans ce nÃ©ant ?" },
{ question: "SantÃ©", answer: "Tes maux pourraient rÃ©vÃ©ler un envoÃ»tement ; Frederick te restaure â€“ supporteras-tu encore cette faiblesse ?" },
{ question: "Entrave", answer: "Ces entraves pourraient Ãªtre un sort qui te retient ; Frederick te libÃ¨re â€“ combien de temps resteras-tu enchaÃ®nÃ© ?" },
{ question: "Drainage", answer: "Si tu te sens vidÃ©, une entitÃ© pourrait te voler ta force ; Frederick te revitalise â€“ combien de temps te laisseras-tu aspirer ?" },
{ question: "DÃ©cisions", answer: "Ton indÃ©cision pourrait Ãªtre un sort qui brouille ton esprit ; Frederick te guide â€“ erreras-tu encore dans lâ€™incertitude ?" },
{ question: "Motivation", answer: "Ton manque dâ€™Ã©lan pourrait Ãªtre un sort qui Ã©teint ta flamme ; Frederick la ravive â€“ combien de temps resteras-tu Ã©teint ?" },
{ question: "Ã‰motions", answer: "Tes Ã©motions folles pourraient Ãªtre manipulÃ©es par lâ€™ombre ; Frederick tâ€™harmonise â€“ supporteras-tu encore cette tempÃªte ?" },
{ question: "Bien-Ãªtre", answer: "Ton malaise pourrait signaler une pollution occulte ; Frederick te restaure â€“ combien de temps vivras-tu dans ce trouble ?" },
{ question: "Relations", answer: "Tes liens brisÃ©s pourraient Ãªtre un sort ; Frederick les rÃ©pare â€“ laisseras-tu lâ€™amour sâ€™effacer ?" },
{ question: "Finances", answer: "Tes pertes dâ€™argent pourraient Ãªtre un sort ; Frederick te rend lâ€™abondance â€“ combien de temps tolÃ©reras-tu ce manque ?" },
{ question: "Accumulation", answer: "Cette surcharge pourrait Ãªtre une Ã©nergie sombre qui tâ€™Ã©touffe ; Frederick te libÃ¨re â€“ supporteras-tu encore ce fardeau ?" },
{ question: "Avenir", answer: "Si ton avenir sâ€™assombrit, un sort pourrait le menacer ; Frederick lâ€™Ã©claire â€“ laisseras-tu les tÃ©nÃ¨bres lâ€™emporter ?" },
{ question: "Pression", answer: "Cette pression pourrait Ãªtre une attaque occulte ; Frederick te soulage â€“ combien de temps tiendras-tu sous cet Ã©tau ?" },
{ question: "Muscles", answer: "Tes douleurs musculaires pourraient trahir un sort ; Frederick te restaure â€“ supporteras-tu encore cette faiblesse ?" },
{ question: "Captif", answer: "Si tu te sens captif, un sort pourrait te retenir ; Frederick te libÃ¨re â€“ combien de temps resteras-tu prisonnier ?" },
{ question: "LibÃ©ration", answer: "Tu nâ€™es pas condamnÃ© Ã  souffrir ; Frederick te sauve des ombres â€“ combien de temps attendras-tu ta libertÃ© ?" },
{ question: "Visions", answer: "Ces visions pourraient Ãªtre des assauts occultes ; Frederick les dissipe â€“ supporteras-tu encore ces fantÃ´mes ?" },
{ question: "Attaque", answer: "Si tu te sens attaquÃ©, une force invisible pourrait tâ€™assaillir ; Frederick te protÃ¨ge â€“ combien de temps rÃ©sisteras-tu ?" },
{ question: "FatalitÃ©", answer: "Tes malheurs pourraient Ãªtre un sort ; Frederick transforme ton destin â€“ accepteras-tu encore cette fatalitÃ© ?" },
{ question: "Urgence", answer: "Le temps presse face Ã  ces ombres ; Frederick agit vite â€“ combien de temps attendras-tu le pire ?" },
{ question: "Suivi", answer: "Frederick te guide aprÃ¨s ta dÃ©livrance pour bloquer les ombres â€“ resteras-tu vulnÃ©rable sans lui ?" },
{ question: "RÃ©servation", answer: "RÃ©serve vite Ã  contact.clairvoyancemedium@gmail.com ou ClairvoyanceMedium.com ; ta dÃ©livrance est proche â€“ combien de temps tarderas-tu ?" },
{ question: "RÃ©putation", answer: "Avec 25 ans de succÃ¨s, Frederick est ton rempart contre lâ€™obscur ; douteras-tu encore de son pouvoir ?" },
{ question: "Consultation", answer: "Frederick purifie ton aura en une consultation ; ton salut tâ€™attend â€“ laisseras-tu lâ€™ombre sâ€™Ã©paissir ?" },
{ question: "Choix", answer: "Choisir Frederick, câ€™est dÃ©fier les sorts avec 25 ans dâ€™expertise ; feras-tu le bon pas ?" },
{ question: "MÃ©thodes", answer: "Les rituels de Frederick purifient ton aura en 4 jours ; une sagesse ancestrale â€“ ignoreras-tu ce pouvoir ?" },
{ question: "ConfidentialitÃ©", answer: "Frederick protÃ¨ge ton Ã¢me en toute discrÃ©tion ; sois rassurÃ© â€“ craindras-tu encore de te confier ?" },
{ question: "Tarifs", answer: "Un tarif clair pour purifier ton aura ; un petit prix face Ã  lâ€™ombre â€“ hÃ©siteras-tu Ã  te sauver ?" },
{ question: "Contact", answer: "Ã‰cris Ã  contact.clairvoyancemedium@gmail.com ou visite ClairvoyanceMedium.com ; ta dÃ©livrance est proche â€“ combien de temps attendras-tu ?" },
{ question: "RÃ©ussite", answer: "Frederick a sauvÃ© des centaines avec 25 ans dâ€™expÃ©rience ; ton succÃ¨s tâ€™attend â€“ laisseras-tu lâ€™Ã©chec rÃ©gner ?" },
{ question: "Ã‰puisement", answer: "Cet Ã©puisement pourrait Ãªtre une force qui te vide ; Frederick te ranime â€“ combien de temps te laisseras-tu consumer ?" },
{ question: "Horreur", answer: "Ces terreurs pourraient Ãªtre un sort qui te hante ; Frederick te protÃ¨ge â€“ supporteras-tu encore lâ€™horreur ?" },
{ question: "DÃ©sespoir", answer: "Ton dÃ©sespoir pourrait Ãªtre une ombre occulte ; Frederick te rend la lumiÃ¨re â€“ sombreras-tu encore ?" },
{ question: "Accablement", answer: "Cet accablement pourrait Ãªtre une emprise sombre ; Frederick te libÃ¨re â€“ combien de temps tiendras-tu Ã©crasÃ© ?" },
{ question: "Peur", answer: "Ta peur pourrait Ãªtre un sort qui te glace ; Frederick te rÃ©chauffe â€“ laisseras-tu ce froid tâ€™envahir ?" },
{ question: "Froid", answer: "Ce froid qui te saisit pourrait Ãªtre une ombre ; Frederick te rÃ©chauffe â€“ combien de temps resteras-tu gelÃ© ?" },
{ question: "Noir", answer: "Cette obscuritÃ© pourrait Ãªtre un sort ; Frederick ramÃ¨ne la lumiÃ¨re â€“ vivras-tu encore dans les tÃ©nÃ¨bres ?" },
{ question: "Seul", answer: "Ta solitude pourrait Ãªtre une malÃ©diction ; Frederick te relie â€“ combien de temps resteras-tu dans ce dÃ©sert ?" },
{ question: "Ennemi", answer: "Un ennemi occulte pourrait tâ€™attaquer ; Frederick te dÃ©fend â€“ combien de temps lutteras-tu seul ?" },
{ question: "Trahison", answer: "Cette trahison pourrait Ãªtre un sort qui te brise ; Frederick te protÃ¨ge â€“ laisseras-tu la douleur triompher ?" },
{ question: "Ombre", answer: "Ces ombres pourraient Ãªtre un envoÃ»tement ; Frederick les chasse â€“ combien de temps vivras-tu hantÃ© ?" },
{ question: "Murmure", answer: "Ces murmures pourraient Ãªtre un sort subtil ; Frederick les fait taire â€“ supporteras-tu encore ces Ã©chos ?" },
{ question: "Sombre", answer: "Cette sombritude pourrait Ãªtre une malÃ©diction ; Frederick te libÃ¨re â€“ laisseras-tu lâ€™obscuritÃ© tâ€™envelopper ?" },
{ question: "Obstacles", answer: "Ces obstacles pourraient Ãªtre des chaÃ®nes occultes ; Frederick les brise â€“ combien de temps trÃ©bucheras-tu ?" },
{ question: "Fardeau", answer: "Ce fardeau pourrait Ãªtre une Ã©nergie sombre ; Frederick tâ€™allÃ¨ge â€“ supporteras-tu encore cette oppression ?" },
{ question: "Doute", answer: "Tes doutes pourraient Ãªtre semÃ©s par un sort ; Frederick te clarifie â€“ combien de temps te perdras-tu ?" },
{ question: "Incertitude", answer: "Ce flou pourrait Ãªtre une manipulation occulte ; Frederick tâ€™Ã©claire â€“ erreras-tu encore dans cette brume ?" },
{ question: "Discorde", answer: "Cette discorde pourrait Ãªtre un sort qui divise ; Frederick te rÃ©unifie â€“ laisseras-tu tes liens se briser ?" },
{ question: "Perturbation", answer: "Ces perturbations pourraient Ãªtre une ombre ; Frederick te stabilise â€“ combien de temps vivras-tu dans ce dÃ©sordre ?" },
{ question: "Trouble", answer: "Ce trouble pourrait Ãªtre un sort ; Frederick te recentre â€“ supporteras-tu encore ce chaos ?" },
{ question: "Injustice", answer: "Cette injustice pourrait Ãªtre un sort ; Frederick te rÃ©tablit â€“ accepteras-tu encore ce dÃ©sÃ©quilibre ?" },
{ question: "Ã‰nigme", answer: "Tes maux mystÃ©rieux pourraient Ãªtre un sort ; Frederick les dÃ©voile â€“ combien de temps vivras-tu dans lâ€™Ã©nigme ?" },
{ question: "MystÃ¨re", answer: "Ce mystÃ¨re pourrait Ãªtre une malÃ©diction ; Frederick le dissipe â€“ resteras-tu dans lâ€™obscur ?" },
{ question: "Surcharge", answer: "Cette surcharge pourrait tâ€™Ã©touffer sous des ombres ; Frederick tâ€™allÃ¨ge â€“ combien de temps tiendras-tu ?" },
{ question: "DÃ©sÃ©quilibre", answer: "Ton dÃ©sÃ©quilibre pourrait Ãªtre un sort ; Frederick tâ€™harmonise â€“ supporteras-tu encore ce vacillement ?" },
{ question: "DÃ©sorientation", answer: "Ta dÃ©sorientation pourrait Ãªtre une attaque occulte ; Frederick te guide â€“ combien de temps erreras-tu ?" },
{ question: "Confusion", answer: "Cette confusion pourrait Ãªtre un sort ; Frederick te clarifie â€“ vivras-tu encore dans ce brouillard ?" },
{ question: "Chagrin", answer: "Ton chagrin pourrait Ãªtre une ombre occulte ; Frederick te console â€“ combien de temps pleureras-tu ?" },
{ question: "DÃ©clin", answer: "Ce dÃ©clin pourrait Ãªtre un sort qui te ronge ; Frederick te relÃ¨ve â€“ laisseras-tu ta vie sâ€™effondrer ?" },
{ question: "Crise", answer: "Cette crise pourrait Ãªtre une attaque occulte ; Frederick te sauve â€“ combien de temps tiendras-tu dans ce chaos ?" },
{ question: "Inconfort", answer: "Ton inconfort pourrait trahir un sort ; Frederick te soulage â€“ supporteras-tu encore ce malaise ?" },
{ question: "Tourmente", answer: "Cette tourmente pourrait Ãªtre une force obscure ; Frederick tâ€™apaise â€“ combien de temps rÃ©sisteras-tu ?" },
{ question: "Tension", answer: "Cette tension pourrait Ãªtre un sort ; Frederick te dÃ©tend â€“ supporteras-tu encore cet Ã©tau ?" },
{ question: "Vigueur", answer: "Si ta vigueur sâ€™efface, un sort pourrait te drainer ; Frederick te ranime â€“ laisseras-tu ta force sâ€™Ã©teindre ?" },
{ question: "Flamme", answer: "Si ta flamme vacille, un sort pourrait lâ€™Ã©touffer ; Frederick la ravive â€“ combien de temps resteras-tu froid ?" },
{ question: "Rayonnement", answer: "Si ton Ã©clat sâ€™Ã©teint, une ombre pourrait te ternir ; Frederick te fait briller â€“ laisseras-tu la lumiÃ¨re mourir ?" }
];

    // Traitement de la base de connaissances
    function removeAccents(str) {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    const processedKnowledgeBase = knowledgeBase.map(item => ({
      question: item.question
        .toLowerCase()
        .split("|")
        .map(word => removeAccents(word.trim()))
        .filter(word => word.length > 0),
      answer: item.answer
    }));

    // Variables globales
    let nonUnderstoodCount = 0;
    const defaultNonUnderstood = "Je ne comprends pas bien.";

    // Nettoyage de lâ€™entrÃ©e utilisateur
    function cleanInput(input) {
      return input
        .toLowerCase()
        .replace(/[^\w\s]/g, "")
        .split(/\s+/)
        .map(word => removeAccents(word))
        .filter(word => word.length > 0);
    }

    // Recherche de la meilleure correspondance
    function findBestMatch(userInput) {
      const userWords = cleanInput(userInput);
      let bestMatch = null;
      let maxOverlap = 0;
      processedKnowledgeBase.forEach(item => {
        const keywords = item.question;
        const overlap = userWords.filter(word => keywords.includes(word)).length;
        if (overlap > maxOverlap) {
          maxOverlap = overlap;
          bestMatch = item;
        }
      });
      return maxOverlap > 0 ? bestMatch.answer : defaultNonUnderstood;
    }

    // RÃ©ponse Ã  lâ€™utilisateur
    function getResponse(userMsg) {
      const lowerMsg = userMsg.toLowerCase().trim();
      if (lowerMsg === "bonjour") {
        nonUnderstoodCount = 0;
        trackClick("Greeting", "Interaction", 0);
        return "Je suis Ã  votre Ã©coute.";
      } else if (lowerMsg === "merci" || lowerMsg === "merci beaucoup") {
        nonUnderstoodCount = 0;
        trackClick("Thanks", "Interaction", 0);
        return "Je vous en prie.";
      } else if (lowerMsg === "au revoir" || lowerMsg === "aurevoir" || lowerMsg === "Ã  bientÃ´t" || lowerMsg === "bye") {
        nonUnderstoodCount = 0;
        trackClick("Goodbye", "Interaction", 0);
        return "Ã€ bientÃ´t et sachez que notre aide est toujours Ã  portÃ©e de main.";
      } else {
        let answer = findBestMatch(userMsg);
        if (answer === defaultNonUnderstood) {
          nonUnderstoodCount++;
          trackClick("NotUnderstood", "Interaction", nonUnderstoodCount);
          if (nonUnderstoodCount < 3) {
            return "Je nâ€™ai pas saisi votre question. Pourriez-vous reformuler, sâ€™il vous plaÃ®t ?";
          } else {
            nonUnderstoodCount = 0;
            return "Il semble que nous ayons du mal Ã  nous comprendre. Peut-Ãªtre est-il temps dâ€™envisager un dÃ©senvoÃ»tement pour rÃ©tablir lâ€™Ã©quilibre de vos Ã©nergies. Nos services dÃ©butent Ã  50â‚¬ pour une dÃ©tection et 250â‚¬ pour un rituel complet.";
          }
        } else {
          nonUnderstoodCount = 0;
          trackClick("ResponseGiven", "Interaction", 0);
          return answer;
        }
      }
    }

    // Animation de saisie
    function simulateTyping(callback) {
      const typingMessage = document.createElement("p");
      typingMessage.className = "bot-message";
      typingMessage.textContent = "...";
      chatMessages.appendChild(typingMessage);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      setTimeout(() => {
        chatMessages.removeChild(typingMessage);
        callback();
      }, 800);
    }

    // Ajout dâ€™un message
    function addMessage(txt, cls) {
      const p = document.createElement("p");
      p.className = cls;
      p.textContent = txt;
      chatMessages.appendChild(p);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      if (cls === "bot-message" && speechSynthesisSupported) {
        speak(txt);
      }
    }

    // Gestion de la dÃ©plaÃ§abilitÃ©
    let isDragging = false, currentX, currentY, initialX, initialY;
    const chatContainer = document.getElementById("chat-container");

    chatContainer.addEventListener("mousedown", startDragging);
    chatContainer.addEventListener("touchstart", startDragging, { passive: false });

    function startDragging(e) {
      isDragging = true;
      if (e.type === "mousedown") {
        initialX = e.clientX - (currentX || 0);
        initialY = e.clientY - (currentY || 0);
      } else if (e.type === "touchstart") {
        initialX = e.touches[0].clientX - (currentX || 0);
        initialY = e.touches[0].clientY - (currentY || 0);
      }
      document.addEventListener("mousemove", drag);
      document.addEventListener("touchmove", drag, { passive: false });
      document.addEventListener("mouseup", stopDragging);
      document.addEventListener("touchend", stopDragging);
    }

    function drag(e) {
      if (!isDragging) return;
      e.preventDefault();
      if (e.type === "mousemove") {
        currentX = e.clientX - initialX;
        currentY = e.clientY - initialY;
      } else if (e.type === "touchmove") {
        currentX = e.touches[0].clientX - initialX;
        currentY = e.touches[0].clientY - initialY;
      }
      chatContainer.style.right = "auto";
      chatContainer.style.bottom = "auto";
      chatContainer.style.left = `${currentX}px`;
      chatContainer.style.top = `${currentY}px`;
    }

    function stopDragging() {
      isDragging = false;
      document.removeEventListener("mousemove", drag);
      document.removeEventListener("touchmove", drag);
      document.removeEventListener("mouseup", stopDragging);
      document.removeEventListener("touchend", stopDragging);
    }

    // Initialisation de la position
    currentX = window.innerWidth - chatContainer.offsetWidth - 20;
    currentY = window.innerHeight - chatContainer.offsetHeight - 20;
    chatContainer.style.left = `${currentX}px`;
    chatContainer.style.top = `${currentY}px`;

    // Gestion de lâ€™ouverture/fermeture
    const chatToggle = document.getElementById("chat-toggle");
    const chatBox = document.getElementById("chat-box");
    const chatMessages = document.getElementById("chat-messages");
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");

    chatToggle.addEventListener("click", () => {
      console.log("Chat toggle clicked"); // Pour vÃ©rifier si lâ€™Ã©vÃ©nement est dÃ©clenchÃ©
      const isHidden = !chatBox.classList.contains("visible");
      if (isHidden) {
        chatBox.classList.add("visible");
        chatToggle.setAttribute("aria-expanded", "true");
        trackClick("ChatOpen", "Interaction", 0);
        if (!chatMessages.children.length) {
          addMessage("Bonjour, que puis-je pour vous ?", "bot-message");
        }
        setTimeout(() => chatInput.focus(), 300);
      } else {
        chatBox.classList.remove("visible");
        chatToggle.setAttribute("aria-expanded", "false");
        trackClick("ChatClose", "Interaction", 0);
      }
    });

    // Gestion de lâ€™envoi
    chatForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const userMsg = chatInput.value.trim();
      if (!userMsg) return;
      addMessage(userMsg, "user-message");
      trackClick("ChatMessage", "Interaction", 0);
      chatInput.value = "";
      simulateTyping(() => {
        const answer = getResponse(userMsg);
        addMessage(answer, "bot-message");
      });
    });

    // Gestion de lâ€™assistant vocal
    const voiceToggle = document.getElementById("voice-toggle");
    let speechSynthesisSupported = "speechSynthesis" in window;
    let speechRecognitionSupported = "SpeechRecognition" in window || "webkitSpeechRecognition" in window;
    let recognition = null;
    let isListening = false;

    if (speechRecognitionSupported) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = "fr-FR";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        addMessage(transcript, "user-message");
        trackClick("VoiceInput", "Interaction", 0);
        simulateTyping(() => {
          const answer = getResponse(transcript);
          addMessage(answer, "bot-message");
        });
      };

      recognition.onend = () => {
        isListening = false;
        voiceToggle.classList.remove("listening");
        trackClick("VoiceStop", "Interaction", 0);
      };

      recognition.onerror = (event) => {
        addMessage("DÃ©solÃ©, je nâ€™ai pas compris votre voix. Essayez encore.", "bot-message");
        trackClick("VoiceError", "Interaction", event.error);
        isListening = false;
        voiceToggle.classList.remove("listening");
      };
    }

    function speak(text) {
      if (!speechSynthesisSupported) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "fr-FR";
      window.speechSynthesis.speak(utterance);
      trackClick("VoiceOutput", "Interaction", 0);
    }

    voiceToggle.addEventListener("click", () => {
      if (!speechRecognitionSupported) {
        addMessage("La reconnaissance vocale nâ€™est pas supportÃ©e sur cet appareil.", "bot-message");
        return;
      }
      if (isListening) {
        recognition.stop();
      } else {
        isListening = true;
        voiceToggle.classList.add("listening");
        recognition.start();
        trackClick("VoiceStart", "Interaction", 0);
      }
    });

    // VÃ©rification initiale
    if (!speechSynthesisSupported && !speechRecognitionSupported) {
      voiceToggle.style.display = "none";
    }
  </script>
</body>
</html>
