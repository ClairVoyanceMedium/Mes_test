<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https: blob:; font-src 'self' https://fonts.gstatic.com data:; connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com; media-src 'self' blob:;">
  
  <title>Chat IA Spirituel - ClairVoyanceMedium.com</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2RSFE6WL4M"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2RSFE6WL4M', {'anonymize_ip': true});
  </script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --bg:#000;
      --text:#fff;
      --gold:#FFD700;
      --burgundy:#FF6B6B;
      --burgundy-light:#FF8787;
      --silver:#C0C0C0;
      --silver-light:#D3D3D3;
    }
    
    *{margin:0;padding:0;box-sizing:border-box;}
    
    body{
      font-family:'Cinzel',serif;
      background:var(--bg);
      color:var(--text);
      text-align:center;
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      touch-action:manipulation;
      overscroll-behavior-y:contain;
    }
    
    header{
      padding:1.5rem 0;
      background:#111;
      box-shadow:0 4px 10px rgba(0,0,0,.8);
    }
    
    .logo{
      width:min(90vw,720px);
      max-width:100%;
      height:auto;
      object-fit:contain;
      display:block;
      margin:0 auto;
    }
    
    nav{
      background:#111;
      padding:1rem;
      box-shadow:0 2px 10px rgba(255,215,0,0.3);
      margin-bottom:1rem;
    }
    
    nav ul{
      list-style:none;
      padding:0;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:0.5rem;
      max-width:1200px;
      margin:0 auto;
    }
    
    nav ul li a{
      font-family:'Cinzel',serif;
      font-size:clamp(0.85rem, 2.5vw, 1.1rem);
      color:#BBAE98;
      text-decoration:none;
      padding:0.5rem 1rem;
      background:#111;
      border:1px solid #BBAE98;
      border-radius:0;
      transition:background .3s ease,color .3s ease;
      display:inline-block;
      text-align:center;
      white-space:nowrap;
    }
    
    nav ul li a:hover{
      background:#BBAE98;
      color:#111;
    }
    
    .chat-intro{
      max-width:900px;
      margin:2.5rem auto 3rem;
      padding:0 1rem;
      font-size:clamp(1rem, 4vw, 1.6rem);
      background:linear-gradient(145deg, #C0C0C0, #E8E8E8, #A8A8A8);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      font-weight:700;
      letter-spacing:1px;
    }
    
    #chat-container{
      max-width:900px;
      margin:1rem auto 2rem;
      padding:0 1rem;
    }
    
    #chat-box{
      background:#111;
      border-radius:0;
      border:2px solid var(--burgundy);
      box-shadow:0 0 12px var(--burgundy);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      height:650px;
    }
    
    #chat-messages{
      flex:1;
      padding:1.5rem;
      overflow-y:auto;
      color:#fff;
      background:#0a0a0a;
      overscroll-behavior-y:contain;
    }
    
    #chat-messages::-webkit-scrollbar{width:10px;}
    #chat-messages::-webkit-scrollbar-track{background:#1a1a1a;}
    #chat-messages::-webkit-scrollbar-thumb{background:var(--burgundy);}
    
    #chat-messages p{
      margin-bottom:1rem;
      line-height:1.7;
      opacity:0;
      animation:fadeIn 0.6s forwards;
    }
    
    @keyframes fadeIn{to{opacity:1;}}
    
    .bot-message{
      text-align:left;
      color:#fff;
      background:rgba(255,107,107,0.15);
      padding:1rem;
      border-radius:0;
      margin-bottom:1rem;
      border:2px solid var(--burgundy);
      box-shadow:0 0 12px rgba(255,107,107,0.4);
      max-width:90%;
    }
    
    .user-message{
      text-align:right;
      color:#fff;
      margin-bottom:1rem;
      border:2px solid var(--silver);
      box-shadow:0 0 12px rgba(192,192,192,0.4);
      padding:1rem;
      border-radius:0;
      max-width:90%;
      margin-left:auto;
      background:linear-gradient(145deg, rgba(192,192,192,0.1), rgba(211,211,211,0.08));
    }
    
    #chat-form{
      display:flex;
      flex-direction:column;
      border-top:2px solid var(--burgundy);
      padding:1rem;
      background:#111;
      gap:0.8rem;
    }
    
    .input-row{
      display:flex;
      gap:0.7rem;
      align-items:center;
    }
    
    #chat-input{
      flex:1;
      padding:1rem;
      border:2px solid var(--burgundy);
      outline:none;
      color:#fff;
      background:#0a0a0a;
      border-radius:0;
      font-family:'Cinzel',serif;
      font-size:0.9rem;
    }
    
    #chat-input::placeholder{
      color:#999;
      opacity:0.7;
      font-style:italic;
      font-size:0.75rem;
    }
    
    #voice-toggle{
      width:50px;
      height:50px;
      background:linear-gradient(145deg,#87CEEB,#5eb6d1);
      color:#fff;
      border:none;
      border-radius:50%;
      cursor:pointer;
      box-shadow:0 4px 15px rgba(135,206,235,0.8);
      font-size:1.4rem;
      display:flex;
      align-items:center;
      justify-content:center;
      transition:transform 0.2s;
    }
    
    #voice-toggle:hover{
      transform:scale(1.1);
    }
    
    #voice-toggle.disabled{
      background:linear-gradient(145deg,#808080,#666);
      opacity:0.7;
    }
    
    #chat-send{
      width:100%;
      background:linear-gradient(145deg,var(--burgundy-light),var(--burgundy));
      border:none;
      padding:1rem 1.8rem;
      cursor:pointer;
      color:#fff;
      font-weight:bold;
      border-radius:0;
      transition:transform .2s;
      font-family:'Cinzel',serif;
      box-shadow:0 4px 15px rgba(255,107,107,.5);
      font-size:1.1rem;
    }
    
    #chat-send:hover{
      transform:scale(1.03);
    }
    
    .return-line{
      font-family:'Cinzel',serif;
      font-size:0.9rem;
      margin:4.5rem auto 1rem;
      text-align:center;
      padding:0 1rem;
    }
    
    .return-line a{
      color:#5B9BD5;
      text-decoration:underline;
      text-decoration-thickness:2px;
      transition:color 0.3s ease;
      display:inline-flex;
      align-items:center;
      gap:0.5rem;
    }
    
    .return-line a:before{
      content:"‚Üê";
      font-size:1.4rem;
      font-weight:bold;
    }
    
    .return-line a:hover{
      color:#87CEEB;
    }
    
    footer{
      margin-top:2rem;
      font-size:.9rem;
      color:#aaa;
      padding:2rem 1rem;
      background:#111;
    }
    
    footer a{
      color:var(--gold);
      text-decoration:none;
    }
    
    footer a:hover{
      color:#fff;
    }
    
    @media(max-width:768px){
      .logo{width:95vw;}
      #chat-box{height:550px;}
    }
    
    @media(max-width:480px){
      nav ul{flex-direction:column;}
      nav ul li a{display:block;width:100%;}
      #chat-box{height:500px;}
      .logo{width:98vw;}
    }
  </style>
</head>
<body>
  <header>
    <picture>
      <source srcset="https://i.imgur.com/GmyGlKk.webp" type="image/webp">
      <img src="https://i.imgur.com/GmyGlKk.jpg" alt="Logo ClairVoyanceMedium" class="logo" width="720" height="720">
    </picture>
  </header>
  
  <nav>
    <ul>
      <li><a href="https://clairvoyancemedium.github.io/Voyancepartelephonepaschere.github.io/" target="_blank" rel="noopener noreferrer">Voyance T√©l 30min/30‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Voyance-3-Questions-par-Email-cbaaaaaca.asp" target="_blank" rel="noopener noreferrer">Voyance Email 3Q/12‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Reconquerir-son-ex-a-distance-Blanche-cbaaaaasa.asp" target="_blank" rel="noopener noreferrer">Retour Ex/175‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Compatibilite-amoureuse-cbaaaaata.asp" target="_blank" rel="noopener noreferrer">Compatibilit√©/20‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Desenvoutement-et-protection-a-distance-cbaaaaala.asp" target="_blank" rel="noopener noreferrer">Purification/150‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Recevez-1-message-d-un-defunt-cbaaaabka.asp" target="_blank" rel="noopener noreferrer">D√©funt/17‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Medecine-Consultation-par-email-cbaaaabja.asp" target="_blank" rel="noopener noreferrer">Sant√©/30‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Ligne-de-la-main-Voyance-3-questions-cbaaaaana.asp" target="_blank" rel="noopener noreferrer">Main/10‚Ç¨</a></li>
      <li><a href="https://www.clairvoyancemedium.com/Message-de-votre-Ange-gardien-cbaaaabba.asp" target="_blank" rel="noopener noreferrer">Ange/10‚Ç¨</a></li>
    </ul>
  </nav>
  
  <div class="chat-intro">Chat IA Spirituel - ClairVoyanceGPT</div>
  
  <div id="chat-container">
    <div id="chat-box">
      <div id="chat-messages"></div>
      <form id="chat-form">
        <div class="input-row">
          <input type="text" id="chat-input" placeholder="Votre question..." autocomplete="off">
          <button type="button" id="voice-toggle" title="Assistant vocal">üé§</button>
        </div>
        <button type="submit" id="chat-send">Envoyer</button>
      </form>
    </div>
  </div>
  
  <div class="return-line">
    <a href="https://www.clairvoyancemedium.com/" target="_blank" rel="noopener noreferrer">Retour vers le cabinet de voyance ClairVoyanceMedium.com</a>
  </div>
  
  <footer>
    <p style="color:#aaa;">¬© 2006-<span id="current-year"></span> ClairVoyanceMedium.com - Tous droits r√©serv√©s</p>
    <p><a href="https://www.clairvoyancemedium.com/Conditions-Generales-des-Ventes-et-d-Utilisation-ccsaaaaaa.asp" target="_blank" rel="noopener noreferrer" style="color:#aaa;">Conditions G√©n√©rales</a></p>
  </footer>
  
  <script>
document.getElementById('current-year').textContent = new Date().getFullYear();

function trackClick(label, category, value) {
  if (typeof gtag === 'function') {
    gtag('event', label, {'event_category': category, 'event_label': label, 'value': value});
  }
}

let userName = '';
let messageCount = 0;
let voiceEnabled = true;
let recognition = null;
let nonUnderstoodCount = 0;

function speak(text) {
  if (!voiceEnabled || !('speechSynthesis' in window)) return;
  const textToSpeak = text.replace(/https?:\/\/[^\s]+/g, '');
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(textToSpeak);
  utterance.lang = 'fr-FR';
  utterance.pitch = 0.5;
  utterance.rate = 1.1;
  window.speechSynthesis.speak(utterance);
}

if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = 'fr-FR';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    document.getElementById('chat-input').value = transcript;
    handleMessage();
  };
}

document.getElementById('voice-toggle').addEventListener('click', () => {
  voiceEnabled = !voiceEnabled;
  document.getElementById('voice-toggle').classList.toggle('disabled', !voiceEnabled);
  if (voiceEnabled && recognition) {
    try { recognition.start(); } catch(e) {}
  } else if (recognition) {
    recognition.stop();
  }
});

function addMessage(text, isBot = false) {
  const messagesDiv = document.getElementById('chat-messages');
  const messageDiv = document.createElement('p');
  messageDiv.className = isBot ? 'bot-message' : 'user-message';
  messageDiv.textContent = text;
  messagesDiv.appendChild(messageDiv);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  if (isBot && voiceEnabled) speak(text);
}

const knowledgeBase = [
    { question: "Fatigue | Lassitude", fullAnswer: "Cette fatigue √©crasante est l'≈ìuvre d'une entit√© obscure qui d√©vore ton √©nergie ; confie la purification de ton aura √† Frederick de ClairVoyanceMedium.com pour retrouver ta vitalit√©." },
    { question: "Cauchemars | Visions | Nuits", fullAnswer: "Ces cauchemars ne sont pas de simples r√™ves, ils sont le r√©sultat d'une pr√©sence mal√©fique ; laisse Frederick du Cabinet ClairVoyanceMedium.com chasser ces ombres pour t'offrir des nuits paisibles." },
    { question: "Sort | Mal√©diction | Envo√ªtement", fullAnswer: "√âpuisement, faiblesse, malchance et cauchemars r√©sultent probablement d'un sort qui te retient captif ; utilise l'intervention de Frederick du Cabinet ClairVoyanceMedium.com pour briser ces liens occultes et ouvrir la voie √† la r√©ussite." }
];

function removeAccents(str) {
    return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
}

function levenshteinDistance(a, b) {
    const matrix = Array(b.length + 1).fill(null).map(() => Array(a.length + 1).fill(null));
    for (let i = 0; i <= a.length; i++) matrix[0][i] = i;
    for (let j = 0; j <= b.length; j++) matrix[j][0] = j;
    for (let j = 1; j <= b.length; j++) {
        for (let i = 1; i <= a.length; i++) {
            const indicator = a[i - 1] === b[j - 1] ? 0 : 1;
            matrix[j][i] = Math.min(
                matrix[j][i - 1] + 1,
                matrix[j - 1][i] + 1,
                matrix[j - 1][i - 1] + indicator
            );
        }
    }
    return matrix[b.length][a.length];
}

function phoneticNormalize(str) {
    return removeAccents(str).replace(/ph/g, "f").replace(/k/g, "c");
}

const processedKnowledgeBase = knowledgeBase.map(item => ({
    question: item.question.toLowerCase().split("|").map(word => phoneticNormalize(removeAccents(word.trim()))),
    fullAnswer: item.fullAnswer
}));

function cleanInput(input) {
    return input.toLowerCase().replace(/[^\w\s]/g, "").split(/\s+/).map(word => phoneticNormalize(removeAccents(word)));
}

function findBestMatch(userInput) {
    const userWords = cleanInput(userInput);
    let bestMatch = null, maxScore = 0;

    processedKnowledgeBase.forEach(item => {
        let score = 0;
        userWords.forEach(userWord => {
            item.question.forEach(kbWord => {
                const distance = levenshteinDistance(userWord, kbWord);
                const similarity = 1 - distance / Math.max(userWord.length, kbWord.length);
                if (similarity >= 0.6) score += similarity;
            });
        });
        if (score > maxScore) {
            maxScore = score;
            bestMatch = item;
        }
    });

    return maxScore > 0 ? bestMatch : null;
}

function handleMessage() {
  const input = document.getElementById('chat-input');
  const userMsg = input.value.trim();
  
  if (!userMsg) return;
  
  addMessage(userMsg, false);
  input.value = '';
  messageCount++;
  
  setTimeout(() => {
    if (!userName) {
      const nameMatch = userMsg.match(/\b([A-Z√Ä-√ñ√ò-√ùa-z√†-√∂√∏-√ø]{2,})\b/);
      if (nameMatch && messageCount >= 2) {
        userName = nameMatch[1].charAt(0).toUpperCase() + nameMatch[1].slice(1).toLowerCase();
        addMessage(`Enchant√© ${userName} ! Comment puis-je vous aider aujourd'hui ?`, true);
        return;
      }
    }
    
    const lowerMsg = userMsg.toLowerCase().trim();
    
    if (lowerMsg === "bonjour" || lowerMsg.startsWith("bonjour")) {
      if (!userName) {
        addMessage("Bonjour ! Avant de commencer, puis-je conna√Ætre votre pr√©nom s'il vous pla√Æt ?", true);
      } else {
        addMessage(`Ravi de vous retrouver ${userName} ! Comment puis-je vous aider aujourd'hui ?`, true);
      }
      return;
    }
    
    const goodbyeTriggers = ["au revoir", "aurevoir", "√† bient√¥t", "bye"];
    if (goodbyeTriggers.some(phrase => lowerMsg === phrase || lowerMsg.startsWith(phrase))) {
      addMessage("√Ä tr√®s bient√¥t ! Frederick et toute l'√©quipe de ClairVoyanceMedium.com restent √† votre √©coute.", true);
      return;
    }
    
    const match = findBestMatch(userMsg);
    
    if (match) {
      addMessage(match.fullAnswer, true);
    } else {
      nonUnderstoodCount++;
      if (nonUnderstoodCount < 3) {
        addMessage("Je ne suis pas s√ªr d'avoir bien compris. Pouvez-vous reformuler avec d'autres mots ?", true);
      } else {
        addMessage("Il semble que nous ayons du mal √† nous comprendre. Peut-√™tre est-il temps d'envisager une consultation directe. Nos services d√©butent √† 50‚Ç¨ pour une d√©tection ou 250‚Ç¨ pour un rituel complet.", true);
        nonUnderstoodCount = 0;
      }
    }
  }, 800);
}

document.getElementById('chat-send').addEventListener('click', (e) => {
  e.preventDefault();
  handleMessage();
});

document.getElementById('chat-input').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    handleMessage();
  }
});

document.getElementById('chat-form').addEventListener('submit', (e) => {
  e.preventDefault();
  handleMessage();
});

setTimeout(() => {
  addMessage("Bienvenue sur ClairVoyanceGPT, l'assistant spirituel de Frederick, m√©dium depuis plus de 25 ans.", true);
}, 500);
</script>
</body>
</html>

