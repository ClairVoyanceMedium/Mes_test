<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat IA avec Tracking et Assistant Vocal</title>
  <style>
    /* Conteneur g√©n√©ral du chat avec effet n√©on */
    #chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      max-height: 450px;
      display: flex;
      flex-direction: column;
      z-index: 999999;
      font-family: Arial, sans-serif;
      cursor: move;
      transition: transform 0.2s;
    }
    /* Bouton de bascule */
    #chat-toggle {
      width: 60px;
      height: 60px;
      background: linear-gradient(145deg, #FFB6C1, #FF69B4);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: move;
      box-shadow: 0 4px 12px rgba(255,105,180,0.7);
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      outline: none;
    }
    #chat-toggle:hover {
      transform: scale(1.05);
    }
    /* Bouton vocal */
    #voice-toggle {
      width: 40px;
      height: 40px;
      background: linear-gradient(145deg, #87CEEB, #5eb6d1);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(135,206,235,0.7);
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 10px;
      transition: transform 0.2s;
      outline: none;
    }
    #voice-toggle:hover {
      transform: scale(1.05);
    }
    /* Indicateur de d√©sactivation de la voix */
    #voice-toggle.disabled {
      background: #808080;
      box-shadow: 0 0 10px #808080;
    }
    /* Bo√Æte de dialogue avec contour n√©on rose fluo */
    #chat-box {
      background: #111;
      border-radius: 10px;
      flex: 1;
      display: none; /* Contr√¥l√© via JS */
      flex-direction: column;
      overflow: hidden;
      margin-top: 10px;
      border: 2px solid #FF1493;
      box-shadow: 0 0 10px #FF1493;
      transition: all 0.3s ease;
    }
    #chat-box.visible {
      display: flex; /* Affichage lorsque visible */
    }
    /* Zone des messages avec effet fade-in */
    #chat-messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      color: #fff;
    }
    #chat-messages p {
      margin-bottom: 0.5rem;
      line-height: 1.4;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    /* Bulles de messages du bot avec effet n√©on rose */
    .bot-message {
      text-align: left;
      color: #fff;
      background: rgba(255,255,255,0.05);
      padding: 0.5rem;
      border-radius: 5px;
      margin-bottom: 0.8rem;
      display: inline-block;
      max-width: 80%;
      border: 2px solid #FF69B4;
      box-shadow: 0 0 8px #FF69B4;
    }
    /* Bulles de messages de l'utilisateur avec effet n√©on bleu */
    .user-message {
      text-align: right;
      color: #ffd700;
      margin-bottom: 0.8rem;
      border: 2px solid #AED6F1;
      box-shadow: 0 0 8px #AED6F1;
      padding: 0.5rem;
      border-radius: 5px;
      display: inline-block;
      max-width: 80%;
    }
    /* Formulaire de saisie */
    #chat-form {
      display: flex;
      border-top: 1px solid #333;
      align-items: center;
      padding: 0.5rem;
    }
    #chat-input {
      flex: 1;
      padding: 0.5rem;
      border: none;
      outline: none;
      color: #333;
      border-radius: 5px 0 0 5px;
    }
    #chat-send {
      background: #87CEEB;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      color: #fff;
      font-weight: bold;
      border-radius: 0 5px 5px 0;
      transition: background 0.2s;
    }
    #chat-send:hover {
      background: #5eb6d1;
    }
    @media(max-width: 400px) {
      #chat-container {
        width: 90%;
        right: 5%;
        bottom: 5px;
      }
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <!-- Boutons de bascule du chat et de la synth√®se vocale -->
    <div style="display: flex; justify-content: flex-end;">
      <button id="chat-toggle" aria-expanded="false" aria-label="Ouvrir le chat">üí¨</button>
      <button id="voice-toggle" aria-label="Activer/D√©sactiver l'assistant vocal">üé§</button>
    </div>
    
    <!-- Bo√Æte de dialogue (initialement masqu√©e) -->
    <div id="chat-box" role="region" aria-label="Chat IA">
      <div id="chat-messages" aria-live="polite"></div>
      <form id="chat-form" aria-label="Formulaire de saisie pour le Tchat IA">
        <input type="text" id="chat-input" placeholder="Posez votre question..." aria-label="Tapez votre message ici" autocomplete="off">
        <button type="submit" id="chat-send" aria-label="Envoyer votre question">‚û§</button>
      </form>
    </div>
  </div>

  <script>
    // Objet de traduction pour faciliter une √©ventuelle localisation
    const translations = {
      greeting: "Bonjour, que puis-je pour vous ?",
      thanks: "Je vous en prie.",
      goodbye: "√Ä bient√¥t et sachez que notre aide est toujours √† port√©e de main.",
      notUnderstood: "Je n‚Äôai pas saisi votre question. Pourriez-vous reformuler, s‚Äôil vous pla√Æt ?",
      notUnderstoodAfter: "Il semble que nous ayons du mal √† nous comprendre. Peut-√™tre est-il temps d‚Äôenvisager un d√©senvo√ªtement pour r√©tablir l‚Äô√©quilibre de vos √©nergies. Nos services d√©butent √† 50‚Ç¨ pour une d√©tection et 250‚Ç¨ pour un rituel complet.",
      grave: "Votre situation semble extr√™mement pr√©occupante. Il est imp√©ratif d'agir imm√©diatement. Je vous recommande de consulter un sp√©cialiste et de prendre les mesures n√©cessaires sans attendre. Ne laissez pas l'ombre prendre le dessus.",
      intro: "Bonjour, je suis votre assistant. Je suis ici pour vous aider. Parlez, et je vous √©couterai."
    };

    // Fonction de tracking (simul√©e, peut √™tre connect√©e √† une API)
    function trackClick(label, category = 'Chat', value = null) {
      console.log(`Tracking: Label=${label}, Category=${category}, Value=${value}`);
    }

    // Base de connaissances (inchang√©e)
    const knowledgeBase = [
      { question: "Fatigue|Lassitude|Torpeur|√âreintement|Faiblesse|Usure", answer: "Et si cette fatigue √©crasante n‚Äô√©tait pas un hasard, mais une entit√© obscure qui d√©vore ton √©nergie ? Frederick de ClairvoyanceMedium.com purifie ton aura pour te lib√©rer ‚Äì combien de temps te laisseras-tu sombrer ?" },
      { question: "Cauchemars|Visions|NuitsHant√©es|SongeNoir|R√™vesTroubl√©s|PeursNocturnes", answer: "Ces cauchemars qui t‚Äôassaillent pourraient √™tre l‚Äô≈ìuvre d‚Äôune pr√©sence mal√©fique ; Frederick chasse ces ombres pour te rendre tes nuits ‚Äì supporteras-tu encore ces terreurs ?" },
      { question: "Chaos|Turbulence|Confusion|D√©sarroi|Tourbillon|Anxi√©t√©", answer: "Ce chaos qui t‚Äôentoure pourrait cacher une mal√©diction qui brise ton destin ; Frederick r√©tablit l‚Äôordre pour te sauver ‚Äì laisseras-tu la temp√™te t‚Äôemporter ?" },
      { question: "Lourdeur|Oppression|√âtouffement|Poids|Angoisse|√âcrasement", answer: "Cette lourdeur qui t‚Äôoppresse pourrait √™tre une force sombre qui √©touffe ton √¢me ; Frederick te lib√®re de ce joug ‚Äì combien de temps ploieras-tu sous cette ombre ?" },
      { question: "Sort|Mal√©diction|Envo√ªtement|CharmeNoir|MagieObscure|Sorcellerie", answer: "Fatigue, malchance, cauchemars : et si un sort te retenait captif ? Frederick brise ces liens occultes ‚Äì oseras-tu d√©fier cette emprise ?" },
      { question: "√âchec|Revers|Chute|D√©route|Malheur|D√©faite", answer: "Tes √©checs r√©p√©t√©s pourraient √™tre un sort qui bloque ton chemin ; Frederick ouvre ta voie au succ√®s ‚Äì combien de fois tr√©bucheras-tu encore ?" },
      { question: "Insomnie|Agitation|NuitsBlanches|SommeilFuyant|Veille|Inqui√©tude", answer: "Ton insomnie pourrait √™tre une entit√© qui vole ton repos ; Frederick te rend la paix nocturne ‚Äì jusqu‚Äô√† quand tiendras-tu √©veill√© ?" },
      { question: "Douleur|Mal|Souffrance|Br√ªlure|Peine|Tourment", answer: "Ces douleurs inexplicables pourraient trahir une attaque occulte ; Frederick te soulage ‚Äì combien de temps endureras-tu ce feu invisible ?" },
      { question: "Isolement|Solitude|Abandon|D√©tresse|Repli|Froid", answer: "Et si ta solitude √©tait un sort qui t‚Äôarrache aux autres ? Frederick te reconnecte √† la lumi√®re ‚Äì resteras-tu seul dans ce vide ?" },
      { question: "Carri√®re|Travail|Ambition|Stagnation|BlocagePro|√âchecPro", answer: "Ces obstacles dans ta carri√®re pourraient √™tre une mal√©diction ; Frederick lib√®re ton potentiel ‚Äì laisseras-tu ton avenir professionnel s‚Äô√©teindre ?" },
      { question: "Malchance|Infortune|HasardNoir|D√©veine|SortFuneste|Calamit√©", answer: "Ta malchance pourrait √™tre un sort qui assombrit ta vie ; Frederick te ram√®ne la chance ‚Äì combien de coups du sort encaisseras-tu ?" },
      { question: "Amour|Passion|Romance|C≈ìurBris√©| D√©samour|SolitudeAffective", answer: "Si l‚Äôamour te fuit, un sort pourrait fermer ton c≈ìur ; Frederick l‚Äôouvre √† la tendresse ‚Äì supporteras-tu encore ce d√©sert sentimental ?" },
      { question: "Famille|Foyer|Discorde|TensionFamiliale|Fracture|Conflit", answer: "Ces tensions dans ton foyer pourraient √™tre une ombre occulte ; Frederick apaise ton clan ‚Äì laisseras-tu ta famille se d√©chirer ?" },
      { question: "Enfants|Petits|Prog√©niture|Inqui√©tudeJeunes|TristesseEnfant|Souci", answer: "La peine de tes enfants pourrait r√©v√©ler une influence sombre ; Frederick purifie leur aura ‚Äì combien de temps les verras-tu souffrir ?" },
      { question: "Animaux|Compagnons|B√™tes|Nervosit√©Animale|TroubleFaune|Instinct", answer: "L‚Äôagitation de tes animaux pourrait signaler une pr√©sence obscure ; Frederick restaure la paix ‚Äì ignoreras-tu leur cri d‚Äôalarme ?" },
      { question: "Maison|Habitat|Logis|Atmosph√®reLourde|Obscurit√©Domicile|PeurInt√©rieure", answer: "Ton foyer oppressant pourrait √™tre infest√© d‚Äô√©nergies noires ; Frederick le purifie ‚Äì vivras-tu encore dans cette prison ?" },
      { question: "Voiture|V√©hicule|Transport|PanneMyst√©rieuse|DangerRoute|Incertitude", answer: "Les pannes de ta voiture pourraient √™tre un sort ; Frederick la lib√®re ‚Äì risqueras-tu encore ces trajets maudits ?" },
      { question: "Pr√©sence|Ombre|Spectre|AuraNoire|Frisson|Intrusion", answer: "Ce sentiment d‚Äô√™tre suivi pourrait √™tre une entit√© malveillante ; Frederick te prot√®ge ‚Äì combien de temps tol√©reras-tu cette ombre ?" },
      { question: "Angoisse|Crainte|Panique|Terror|Effroi|Nervosit√©", answer: "Ton angoisse pourrait √™tre un sort qui te ronge ; Frederick te calme ‚Äì laisseras-tu la peur te d√©vorer ?" },
      { question: "Irritabilit√©|Col√®re|Frustration|Rage|Impatience|√ânervement", answer: "Ton irritation pourrait trahir une influence occulte ; Frederick te rend la douceur ‚Äì combien de temps exploseras-tu encore ?" },
      { question: "Concentration|Clart√©|Attention|FlouMental|Dispersion|PerteFocus", answer: "Ton esprit brouill√© pourrait √™tre victime d‚Äôun sort ; Frederick te recentre ‚Äì combien de temps erreras-tu dans ce chaos ?" },
      { question: "M√©moire|Oubli|SouvenirPerdu|Amn√©sie|ConfusionMentale|Trou", answer: "Tes pertes de m√©moire pourraient √™tre un envo√ªtement ; Frederick te rend ta clart√© ‚Äì oublieras-tu encore ton pass√© ?" },
      { question: "Lign√©e|H√©ritage|Anc√™tres|Mal√©dictionFamiliale|Pass√©Lourd|Fardeau", answer: "Un sort ancien pourrait hanter ta lign√©e ; Frederick te lib√®re de ce poids ‚Äì laisseras-tu tes anc√™tres te maudire ?" },
      { question: "Oppression|Contrainte|√âtau|Suffocation|Pression|√âtourdissement", answer: "Cette oppression pourrait √™tre une force noire qui t‚Äô√©crase ; Frederick te d√©livre ‚Äì combien de temps tiendras-tu sous ce joug ?" },
      { question: "Souffrance|Affliction|Chagrin|D√©chirement|Mis√®re|Blessure", answer: "Ta souffrance pourrait √™tre une attaque occulte ; Frederick te gu√©rit ‚Äì supporteras-tu encore ce tourment ?" },
      { question: "D√©connexion|VideInt√©rieur|PerteSoi|D√©sunion|Ali√©nation|N√©ant", answer: "Ce vide en toi pourrait √™tre un sort qui te coupe de ton √¢me ; Frederick te reconnecte ‚Äì resteras-tu perdu dans l‚Äôab√Æme ?" },
      { question: "Aura|Vibration|√ânergieSombre|HaloTrouble|√âpuisementAura|OmbreInt√©rieure", answer: "Ton aura ternie pourrait √™tre pollu√©e par l‚Äôobscurit√© ; Frederick la purifie ‚Äì laisseras-tu cette ombre t‚Äô√©teindre ?" },
      { question: "Projets|Ambitions|Plans|√âchecProjet|StagnationR√™ve|Obstacle", answer: "Tes r√™ves bris√©s pourraient √™tre bloqu√©s par un sort ; Frederick lib√®re ton chemin ‚Äì abandonneras-tu encore tes espoirs ?" },
      { question: "Stress|Tension|Nervosit√©|√âpuisementMental|Surcharge|Agitation", answer: "Ce stress pourrait √™tre une emprise occulte ; Frederick t‚Äôapaise ‚Äì combien de temps tiendras-tu sous cette pression ?" },
      { question: "Vie|Destin√©e|Chemin|Obscurit√©Vie|PerteSens|Fatalit√©", answer: "Si ta vie s‚Äôassombrit, un sort pourrait la voiler ; Frederick l‚Äôillumine ‚Äì continueras-tu √† errer dans ce n√©ant ?" },
      { question: "Blocage|Barri√®re|Entrave|Mur|Impuissance|Arr√™t", answer: "Ces blocages pourraient √™tre des cha√Ænes occultes ; Frederick les brise ‚Äì combien de temps resteras-tu immobile ?" },
      { question: "Stagnation|Inertie|Lenteur|Immobilisme|Suspension|Gel", answer: "Ta stagnation pourrait √™tre un sort qui fige ton √¢me ; Frederick te relance ‚Äì supporteras-tu encore cette paralysie ?" },
      { question: "Humeur|Morosit√©|Tristesse|Instabilit√©√âmotion|SautesHumeur|Gloom", answer: "Tes humeurs sombres pourraient √™tre un sort ; Frederick te stabilise ‚Äì laisseras-tu ces ombres te guider ?" },
      { question: "Vide|Absence|D√©sertInt√©rieur|Manque|Aridit√©|S√©cheresse", answer: "Ce vide pourrait √™tre une force qui te draine ; Frederick te remplit de lumi√®re ‚Äì combien de temps vivras-tu dans ce n√©ant ?" },
      { question: "Sant√©|Vitalit√©|Force|Fragilit√©|D√©clinSant√©|Malaise", answer: "Tes maux pourraient r√©v√©ler un envo√ªtement ; Frederick te restaure ‚Äì supporteras-tu encore cette faiblesse ?" },
      { question: "Entrave|Frein|Cha√Æne|ObstaclePhysique|Limitation|Confinement", answer: "Ces entraves pourraient √™tre un sort qui te retient ; Frederick te lib√®re ‚Äì combien de temps resteras-tu encha√Æn√© ?" },
      { question: "Drainage|Aspiration|√âpuisementVital|Siphon|Vampirisme|Perte√ânergie", answer: "Si tu te sens vid√©, une entit√© pourrait te voler ta force ; Frederick te revitalise ‚Äì combien de temps te laisseras-tu aspirer ?" },
      { question: "D√©cisions|Choix|H√©sitation|Ind√©cision|DouteMental|Perplexit√©", answer: "Ton ind√©cision pourrait √™tre un sort qui brouille ton esprit ; Frederick te guide ‚Äì erreras-tu encore dans l‚Äôincertitude ?" },
      { question: "Motivation|√âlan|Inspiration|PerteFeu|Ennui|LassitudeCr√©ative", answer: "Ton manque d‚Äô√©lan pourrait √™tre un sort qui √©teint ta flamme ; Frederick la ravive ‚Äì combien de temps resteras-tu √©teint ?" },
      { question: "√âmotions|Passions|Sentiments|D√©bordement|Temp√™teInt√©rieure|Chaos√âmotionnel", answer: "Tes √©motions folles pourraient √™tre manipul√©es par l‚Äôombre ; Frederick t‚Äôharmonise ‚Äì supporteras-tu encore cette temp√™te ?" },
      { question: "Bien-√™tre|S√©r√©nit√©|Paix|Inconfort|Perturbation|Mal√™tre", answer: "Ton malaise pourrait signaler une pollution occulte ; Frederick te restaure ‚Äì combien de temps vivras-tu dans ce trouble ?" },
      { question: "Relations|Liens|Amiti√©|ConflitRelation|Distance|Cassure", answer: "Tes liens bris√©s pourraient √™tre un sort ; Frederick les r√©pare ‚Äì laisseras-tu l‚Äôamour s‚Äôeffacer ?" },
      { question: "Finances|Argent|PerteRichesse|Pauvret√©|FluxBloqu√©|Dette", answer: "Tes pertes d‚Äôargent pourraient √™tre un sort ; Frederick te rend l‚Äôabondance ‚Äì combien de temps tol√©reras-tu ce manque ?" },
      { question: "Accumulation|Surcharge|Exc√®s|Poids√ânerg√©tique|Saturation|Surabondance", answer: "Cette surcharge pourrait √™tre une √©nergie sombre qui t‚Äô√©touffe ; Frederick te lib√®re ‚Äì supporteras-tu encore ce fardeau ?" },
      { question: "Avenir|Espoir|Futur|IncertitudeAvenir|PeurDestin|Obscurit√©", answer: "Si ton avenir s‚Äôassombrit, un sort pourrait le menacer ; Frederick l‚Äô√©claire ‚Äì laisseras-tu les t√©n√®bres l‚Äôemporter ?" },
      { question: "Pression|Compression|Serrage|√âtreinte|StressPhysique|TensionCorporelle", answer: "Cette pression pourrait √™tre une attaque occulte ; Frederick te soulage ‚Äì combien de temps tiendras-tu sous cet √©tau ?" },
      { question: "Muscles|DouleurMusculaire|Raideur|FatigueCorps|Spasme|√âpuisementPhysique", answer: "Tes douleurs musculaires pourraient trahir un sort ; Frederick te restaure ‚Äì supporteras-tu encore cette faiblesse ?" },
      { question: "Captif|Prison|Encha√Ænement|BlocageMental|ConfinementEsprit|EntravePens√©e", answer: "Si tu te sens captif, un sort pourrait te retenir ; Frederick te lib√®re ‚Äì combien de temps resteras-tu prisonnier ?" },
      { question: "Lib√©ration|D√©livrance|Salut|√âvasion|Rel√¢chement|Affranchissement", answer: "Tu n‚Äôes pas condamn√© √† souffrir ; Frederick te sauve des ombres ‚Äì combien de temps attendras-tu ta libert√© ?" },
      { question: "Visions|Hallucinations|Apparitions|Mirages|ImagesSombres|Illusion", answer: "Ces visions pourraient √™tre des assauts occultes ; Frederick les dissipe ‚Äì supporteras-tu encore ces fant√¥mes ?" },
      { question: "Liens|Attachements|Connexion|FractureLien|IsolementRelation|Rupture", answer: "Tes relations bris√©es pourraient √™tre un sort ; Frederick les restaure ‚Äì laisseras-tu tes liens se dissoudre ?" },
      { question: "Attaque|Agression|Assaut|Menace|Hostilit√©|Invasion√ânerg√©tique", answer: "Si tu te sens attaqu√©, une force invisible pourrait t‚Äôassaillir ; Frederick te prot√®ge ‚Äì combien de temps r√©sisteras-tu ?" },
      { question: "Fatalit√©|Trag√©die|DestinNoir|ChuteIn√©luctable|MalheurFixe|D√©sastre", answer: "Tes malheurs pourraient √™tre un sort ; Frederick transforme ton destin ‚Äì accepteras-tu encore cette fatalit√© ?" },
      { question: "Urgence|Crise|Danger|Imm√©diatet√©|Pr√©cipitation|Alarme", answer: "Le temps presse face √† ces ombres ; Frederick agit vite ‚Äì combien de temps attendras-tu le pire ?" },
      { question: "Suivi|Soutien|Guidance|AssistancePost|ProtectionContinue|Aide", answer: "Frederick te guide apr√®s ta d√©livrance pour bloquer les ombres ‚Äì resteras-tu vuln√©rable sans lui ?" },
      { question: "R√©servation|Consultation|Inscription|RendezVous|PriseContact|Engagement", answer: "R√©serve vite √† contact.clairvoyancemedium@gmail.com ou ClairvoyanceMedium.com pour ta d√©livrance ‚Äì combien de temps tarderas-tu ?" },
      { question: "R√©putation|Cr√©dibilit√©|Renom|Fiabilit√©|Prestige|Confiance", answer: "Avec 25 ans de succ√®s, Frederick est ton rempart contre l‚Äôobscur ; douteras-tu encore de son pouvoir ?" },
      { question: "Consultation|Analyse|Diagnostic|Session|√âvaluation|Rituel", answer: "Frederick purifie ton aura en une consultation ; ton salut t‚Äôattend ‚Äì laisseras-tu l‚Äôombre s‚Äô√©paissir ?" },
      { question: "Choix|Option|Voie|S√©lection|Direction|D√©cisionCl√©", answer: "Choisir Frederick, c‚Äôest d√©fier les sorts avec 25 ans d‚Äôexpertise ; feras-tu le bon pas ?" },
      { question: "M√©thodes|Techniques|Rituels|Pratiques|Secrets|Savoir", answer: "Les rituels de Frederick purifient ton aura en 4 jours ; une sagesse ancestrale ‚Äì ignoreras-tu ce pouvoir ?" },
      { question: "Confidentialit√©|Secret|Discr√©tion|S√©curit√©|Intimit√©|Garde", answer: "Frederick prot√®ge ton √¢me en toute discr√©tion ; sois rassur√© ‚Äì craindras-tu encore de te confier ?" },
      { question: "Tarifs|Co√ªt|Prix|Valeur|Paiement|Investissement", answer: "Un tarif clair pour purifier ton aura ; un petit prix face √† l‚Äôombre ‚Äì h√©siteras-tu √† te sauver ?" },
      { question: "Contact|Appel|Message|Email|Joindre|Communication", answer: "√âcris √† contact.clairvoyancemedium@gmail.com ou visite ClairvoyanceMedium.com ; ta d√©livrance est proche ‚Äì combien de temps attendras-tu ?" },
      { question: "R√©ussite|Victoire|Triomphe|Prosp√©rit√©|Accomplissement|Gain", answer: "Frederick a sauv√© des centaines avec 25 ans d‚Äôexp√©rience ; ton succ√®s t‚Äôattend ‚Äì laisseras-tu l‚Äô√©chec r√©gner ?" },
      { question: "√âpuisement|Ext√©nuation|D√©p√©rissement|Drain|Affaiblissement|Consomption", answer: "Cet √©puisement pourrait √™tre une force qui te vide ; Frederick te ranime ‚Äì combien de temps te laisseras-tu consumer ?" },
      { question: "Horreur|Terreur|Effroi|PeurNoire|FrissonNuit|AngoisseSombre", answer: "Ces terreurs pourraient √™tre un sort qui te hante ; Frederick te prot√®ge ‚Äì supporteras-tu encore l‚Äôhorreur ?" },
      { question: "D√©sespoir|Abattement|TristesseProfonde|Deuil|Melancolie|PerteEspoir", answer: "Ton d√©sespoir pourrait √™tre une ombre occulte ; Frederick te rend la lumi√®re ‚Äì sombreras-tu encore ?" },
      { question: "Accablement|√âcrasement|SuffocationMentale|Poids√Çme|Choc|√âpuisementEsprit", answer: "Cet accablement pourrait √™tre une emprise sombre ; Frederick te lib√®re ‚Äì combien de temps tiendras-tu √©cras√© ?" },
      { question: "Peur|FroidGlacial|FrissonPeur|Tremblement|Inqui√©tudeProfonde|TerreurFroide", answer: "Ta peur pourrait √™tre un sort qui te glace ; Frederick te r√©chauffe ‚Äì laisseras-tu ce froid t‚Äôenvahir ?" },
      { question: "Froid|Gel|Frimas|Glace|ChillInt√©rieur|Froideur√Çme", answer: "Ce froid qui te saisit pourrait √™tre une ombre ; Frederick te r√©chauffe ‚Äì combien de temps resteras-tu gel√© ?" },
      { question: "Noir|T√©n√®bres|Obscurit√©|VoileNoir|SombreDestin|Nuit√âternelle", answer: "Cette obscurit√© pourrait √™tre un sort ; Frederick ram√®ne la lumi√®re ‚Äì vivras-tu encore dans les t√©n√®bres ?" },
      { question: "Seul|D√©solation|Reclus|AbandonTotal|SolitudeFroide|Isolement√Çme", answer: "Ta solitude pourrait √™tre une mal√©diction ; Frederick te relie ‚Äì combien de temps resteras-tu dans ce d√©sert ?" },
      { question: "Ennemi|Adversaire|ForceHostile|MenaceInvisible|Opposant|Malveillance", answer: "Un ennemi occulte pourrait t‚Äôattaquer ; Frederick te d√©fend ‚Äì combien de temps lutteras-tu seul ?" },
      { question: "Trahison|Perfidie|Infid√©lit√©|BlessureLoyaut√©|D√©ception|Duplicit√©", answer: "Cette trahison pourrait √™tre un sort qui te brise ; Frederick te prot√®ge ‚Äì laisseras-tu la douleur triompher ?" },
      { question: "Ombre|Silhouette|VoileSombre|Pr√©senceNoire|Fant√¥me|√ânergieObscure", answer: "Ces ombres pourraient √™tre un envo√ªtement ; Frederick les chasse ‚Äì combien de temps vivras-tu hant√© ?" },
      { question: "Murmure|Chuchotis|VoixSombre|√âchoTrouble|BruitsFant√¥mes|Souffle", answer: "Ces murmures pourraient √™tre un sort subtil ; Frederick les fait taire ‚Äì supporteras-tu encore ces √©chos ?" },
      { question: "Sombre|Cr√©puscule|Noirceur|Grisaille|T√©n√©breux|Morne", answer: "Cette sombritude pourrait √™tre une mal√©diction ; Frederick te lib√®re ‚Äì laisseras-tu l‚Äôobscurit√© t‚Äôenvelopper ?" },
      { question: "Obstacles|MurInvisible|Arr√™tBrutal|Barrage|R√©sistance|ChuteBloqu√©e", answer: "Ces obstacles pourraient √™tre des cha√Ænes occultes ; Frederick les brise ‚Äì combien de temps tr√©bucheras-tu ?" },
      { question: "Fardeau|ChargeLourde|PoidsEsprit|Encombrement|Surcharge√Çme|√âtauMental", answer: "Ce fardeau pourrait √™tre une √©nergie sombre ; Frederick t‚Äôall√®ge ‚Äì supporteras-tu encore cette oppression ?" },
      { question: "Doute|Scepticisme|Suspicion|IncertitudeFroide|M√©fiance|Questionnement", answer: "Tes doutes pourraient √™tre sem√©s par un sort ; Frederick te clarifie ‚Äì combien de temps te perdras-tu ?" },
      { question: "Incertitude|Flou|Ambigu√Øt√©|PerteClart√©|BrumeMentale|Irr√©solution", answer: "Ce flou pourrait √™tre une manipulation occulte ; Frederick t‚Äô√©claire ‚Äì erreras-tu encore dans cette brume ?" },
      { question: "Discorde|D√©sunion|Clash|Division|Querelle|Fracture√Çme", answer: "Cette discorde pourrait √™tre un sort qui divise ; Frederick te r√©unifie ‚Äì laisseras-tu tes liens se briser ?" },
      { question: "Perturbation|Instabilit√©|TroubleVie|AgitationSombre|D√©r√®glement|ChaosInt√©rieur", answer: "Ces perturbations pourraient √™tre une ombre ; Frederick te stabilise ‚Äì combien de temps vivras-tu dans ce d√©sordre ?" },
      { question: "Trouble|D√©sordreMental|√âbranlement|PerteContr√¥le|Inqui√©tudeProfonde|Chavirement", answer: "Ce trouble pourrait √™tre un sort ; Frederick te recentre ‚Äì supporteras-tu encore ce chaos ?" },
      { question: "Injustice| D√©s√©quit√©|Pr√©judice|Partialit√©|ErreurDestin|D√©savantage", answer: "Cette injustice pourrait √™tre un sort ; Frederick te r√©tablit ‚Äì accepteras-tu encore ce d√©s√©quilibre ?" },
      { question: "√ânigme|Myst√®re|Puzzle|SecretCach√©|Incompr√©hension|VoileMystique", answer: "Tes maux myst√©rieux pourraient √™tre un sort ; Frederick les d√©voile ‚Äì combien de temps vivras-tu dans l‚Äô√©nigme ?" },
      { question: "Myst√®re|Insondable|Inconnu|ProfondeurSombre|SecretLourd|√âtranget√©", answer: "Ce myst√®re pourrait √™tre une mal√©diction ; Frederick le dissipe ‚Äì resteras-tu dans l‚Äôobscur ?" },
      { question: "Surcharge|Surmenage|Exc√®sPoids|√âcrasement√ânergie|SaturationMentale|D√©bordement", answer: "Cette surcharge pourrait t‚Äô√©touffer sous des ombres ; Frederick t‚Äôall√®ge ‚Äì combien de temps tiendras-tu ?" },
      { question: "D√©s√©quilibre|Inharmonie|Instabilit√©√Çme|D√©r√®glementVie|Chute√ânergie|Oscillation", answer: "Ton d√©s√©quilibre pourrait √™tre un sort ; Frederick t‚Äôharmonise ‚Äì supporteras-tu encore ce vacillement ?" },
      { question: "D√©sorientation|PerteChemin|√âgar√©|ErranceSombre|D√©routement|Perplexit√©Froide", answer: "Ta d√©sorientation pourrait √™tre une attaque occulte ; Frederick te guide ‚Äì combien de temps erreras-tu ?" },
      { question: "Confusion|Brouillard|ChaosMental|D√©sordreEsprit|FlouSombre|PerteRep√®re", answer: "Cette confusion pourrait √™tre un sort ; Frederick te clarifie ‚Äì vivras-tu encore dans ce brouillard ?" },
      { question: "Chagrin|P√©nombreCoeur|DeuilInt√©rieur|SouffranceMuette|Larme|AfflictionProfonde", answer: "Ton chagrin pourrait √™tre une ombre occulte ; Frederick te console ‚Äì combien de temps pleureras-tu ?" },
      { question: "D√©clin|Effritement|PerteForce|D√©p√©rissement|Regression|Affaissement", answer: "Ce d√©clin pourrait √™tre un sort qui te ronge ; Frederick te rel√®ve ‚Äì laisseras-tu ta vie s‚Äôeffondrer ?" },
      { question: "Crise|Tourmente|√âpreuveSombre|CatastropheInt√©rieure|ChocDestin|Bouleversement", answer: "Cette crise pourrait √™tre une attaque occulte ; Frederick te sauve ‚Äì combien de temps tiendras-tu dans ce chaos ?" },
      { question: "Inconfort|G√™ne|Mal√™trePhysique|D√©sagr√©mentSombre|Irritation|PesanteurCorps", answer: "Ton inconfort pourrait trahir un sort ; Frederick te soulage ‚Äì supporteras-tu encore ce malaise ?" },
      { question: "Tourmente|Temp√™te√Çme|OuraganInt√©rieur|TumulteEsprit|FureurSombre|AgitationProfonde", answer: "Cette tourmente pourrait √™tre une force obscure ; Frederick t‚Äôapaise ‚Äì combien de temps r√©sisteras-tu ?" },
      { question: "Tension|Serrage|Crispation|ContraintePhysique|√âtauCorps|RaideurSombre", answer: "Cette tension pourrait √™tre un sort ; Frederick te d√©tend ‚Äì supporteras-tu encore cet √©tau ?" },
      { question: "Vigueur|Dynamisme|√ânergieVive|ForceInt√©rieure|Puissance|√âlanVital", answer: "Si ta vigueur s‚Äôefface, un sort pourrait te drainer ; Frederick te ranime ‚Äì laisseras-tu ta force s‚Äô√©teindre ?" },
      { question: "Flamme|Ardeur|PassionVive|FeuInt√©rieur|√âclatVie|Chaleur√Çme", answer: "Si ta flamme vacille, un sort pourrait l‚Äô√©touffer ; Frederick la ravive ‚Äì combien de temps resteras-tu chaud ?" },
      { question: "Rayonnement|Luminosit√©|Brillance|√âclat√Çme|LueurInt√©rieure|Chatoiement", answer: "Si ton √©clat s‚Äô√©teint, une ombre pourrait te ternir ; Frederick te fait briller ‚Äì laisseras-tu la lumi√®re mourir ?" }
    ];

    // Pr√©paration de la base de connaissances
    function removeAccents(str) {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    const processedKnowledgeBase = knowledgeBase.map(item => ({
      question: item.question
        .toLowerCase()
        .split("|")
        .map(word => removeAccents(word.trim()))
        .filter(word => word.length > 0),
      answer: item.answer
    }));

    // Variables globales pour les r√©ponses
    let nonUnderstoodCount = 0;
    const defaultNonUnderstood = translations.notUnderstood;

    // Fonction de nettoyage de l'entr√©e utilisateur
    function cleanInput(input) {
      return input
        .toLowerCase()
        .replace(/[^\w\s]/g, "")
        .split(/\s+/)
        .map(word => removeAccents(word))
        .filter(word => word.length > 0);
    }

    // Recherche de la meilleure correspondance dans la base de connaissances
    function findBestMatch(userInput) {
      const userWords = cleanInput(userInput);
      let bestMatch = null;
      let maxOverlap = 0;
      processedKnowledgeBase.forEach(item => {
        const keywords = item.question;
        const overlap = userWords.filter(word => keywords.includes(word)).length;
        if (overlap > maxOverlap) {
          maxOverlap = overlap;
          bestMatch = item;
        }
      });
      return maxOverlap > 0 ? bestMatch.answer : defaultNonUnderstood;
    }

    // G√©n√©ration de la r√©ponse √† l'utilisateur
    function getResponse(userMsg) {
      const lowerMsg = userMsg.toLowerCase().trim();
      // R√©ponses automatiques pr√©d√©finies pour certains mots-cl√©s
      if (lowerMsg === "bonjour") {
        nonUnderstoodCount = 0;
        trackClick("Greeting", "Interaction", 0);
        return translations.greeting;
      } else if (lowerMsg === "merci" || lowerMsg === "merci beaucoup") {
        nonUnderstoodCount = 0;
        trackClick("Thanks", "Interaction", 0);
        return translations.thanks;
      } else if (lowerMsg === "au revoir" || lowerMsg === "aurevoir" || lowerMsg === "√† bient√¥t" || lowerMsg === "bye") {
        nonUnderstoodCount = 0;
        trackClick("Goodbye", "Interaction", 0);
        return translations.goodbye;
      } else if (lowerMsg === "c'est grave" || lowerMsg === "grave" || lowerMsg === "c'est vraiment grave") {
        nonUnderstoodCount = 0;
        trackClick("Serious", "Interaction", 0);
        return translations.grave;
      } else {
        let answer = findBestMatch(userMsg);
        if (answer === defaultNonUnderstood) {
          nonUnderstoodCount++;
          trackClick("NotUnderstood", "Interaction", nonUnderstoodCount);
          if (nonUnderstoodCount < 3) {
            return translations.notUnderstood;
          } else {
            nonUnderstoodCount = 0;
            return translations.notUnderstoodAfter;
          }
        } else {
          nonUnderstoodCount = 0;
          trackClick("ResponseGiven", "Interaction", 0);
          return answer;
        }
      }
    }

    // Animation de saisie pour simuler la r√©ponse du bot
    function simulateTyping(callback) {
      const typingMessage = document.createElement("p");
      typingMessage.className = "bot-message";
      typingMessage.textContent = "...";
      chatMessages.appendChild(typingMessage);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      setTimeout(() => {
        chatMessages.removeChild(typingMessage);
        callback();
      }, 800);
    }

    // Ajout d‚Äôun message dans la conversation
    function addMessage(txt, cls) {
      const p = document.createElement("p");
      p.className = cls;
      p.textContent = txt;
      chatMessages.appendChild(p);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      if (cls === "bot-message") {
        speak(txt);
      }
    }

    // Gestion de la d√©pla√ßabilit√© du conteneur de chat
    let isDragging = false, currentX, currentY, initialX, initialY;
    const chatContainer = document.getElementById("chat-container");

    chatContainer.addEventListener("mousedown", startDragging);
    chatContainer.addEventListener("touchstart", startDragging, { passive: false });

    function startDragging(e) {
      isDragging = true;
      if (e.type === "mousedown") {
        initialX = e.clientX - (currentX || 0);
        initialY = e.clientY - (currentY || 0);
      } else if (e.type === "touchstart") {
        initialX = e.touches[0].clientX - (currentX || 0);
        initialY = e.touches[0].clientY - (currentY || 0);
      }
      document.addEventListener("mousemove", drag);
      document.addEventListener("touchmove", drag, { passive: false });
      document.addEventListener("mouseup", stopDragging);
      document.addEventListener("touchend", stopDragging);
    }

    function drag(e) {
      if (!isDragging) return;
      e.preventDefault();
      if (e.type === "mousemove") {
        currentX = e.clientX - initialX;
        currentY = e.clientY - initialY;
      } else if (e.type === "touchmove") {
        currentX = e.touches[0].clientX - initialX;
        currentY = e.touches[0].clientY - initialY;
      }
      chatContainer.style.right = "auto";
      chatContainer.style.bottom = "auto";
      chatContainer.style.left = `${currentX}px`;
      chatContainer.style.top = `${currentY}px`;
    }

    function stopDragging() {
      isDragging = false;
      document.removeEventListener("mousemove", drag);
      document.removeEventListener("touchmove", drag);
      document.removeEventListener("mouseup", stopDragging);
      document.removeEventListener("touchend", stopDragging);
    }

    // Initialisation de la position du conteneur
    currentX = window.innerWidth - chatContainer.offsetWidth - 20;
    currentY = window.innerHeight - chatContainer.offsetHeight - 20;
    chatContainer.style.left = `${currentX}px`;
    chatContainer.style.top = `${currentY}px`;

    // Gestion de l‚Äôouverture/fermeture du chat
    const chatToggle = document.getElementById("chat-toggle");
    const chatBox = document.getElementById("chat-box");
    const chatMessages = document.getElementById("chat-messages");
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");

    // Flag pour l'activation automatique du micro √† la premi√®re ouverture
    let firstOpen = true;

    chatToggle.addEventListener("click", () => {
      const isHidden = !chatBox.classList.contains("visible");
      if (isHidden) {
        chatBox.classList.add("visible");
        chatToggle.setAttribute("aria-expanded", "true");
        trackClick("ChatOpen", "Interaction", 0);
        if (!chatMessages.children.length) {
          addMessage(translations.greeting, "bot-message");
        }
        setTimeout(() => chatInput.focus(), 300);
        // Activation automatique du micro et annonce vocale √† la premi√®re ouverture
        if (firstOpen) {
          if (speechRecognitionSupported && recognition) {
            recognition.start();
          }
          speak(translations.intro);
          firstOpen = false;
        }
      } else {
        chatBox.classList.remove("visible");
        chatToggle.setAttribute("aria-expanded", "false");
        trackClick("ChatClose", "Interaction", 0);
      }
    });

    // Gestion de l‚Äôenvoi d‚Äôun message
    chatForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const userMsg = chatInput.value.trim();
      if (!userMsg) return;
      addMessage(userMsg, "user-message");
      trackClick("ChatMessage", "Interaction", 0);
      chatInput.value = "";
      simulateTyping(() => {
        const answer = getResponse(userMsg);
        addMessage(answer, "bot-message");
      });
    });

    // Gestion de la synth√®se vocale (sortie uniquement)
    let voiceEnabled = true; // Contr√¥le l'activation de la synth√®se vocale

    function speak(text) {
      if (!voiceEnabled || !("speechSynthesis" in window)) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "fr-FR";
      // Param√©trage pour une voix d'homme grave avec un d√©bit l√©g√®rement plus rapide
      utterance.pitch = 0.6;   // Voix grave
      utterance.rate = 1.1;    // Rythme un peu plus rapide
      // S√©lection d'une voix masculine si disponible
      const voices = window.speechSynthesis.getVoices();
      if (voices.length > 0) {
        const maleVoice = voices.find(voice => voice.name.toLowerCase().includes("male") || voice.name.toLowerCase().includes("fran√ßais"));
        if (maleVoice) {
          utterance.voice = maleVoice;
        }
      }
      window.speechSynthesis.speak(utterance);
      trackClick("VoiceOutput", "Interaction", 0);
    }

    // Gestion du bouton vocal pour activer/d√©sactiver la synth√®se vocale
    const voiceToggle = document.getElementById("voice-toggle");
    voiceToggle.addEventListener("click", () => {
      voiceEnabled = !voiceEnabled;
      if (voiceEnabled) {
        voiceToggle.classList.remove("disabled");
        trackClick("VoiceEnabled", "Interaction", 0);
      } else {
        voiceToggle.classList.add("disabled");
        trackClick("VoiceDisabled", "Interaction", 0);
      }
    });

    // Gestion de la reconnaissance vocale (entr√©e)
    let speechRecognitionSupported = "SpeechRecognition" in window || "webkitSpeechRecognition" in window;
    let recognition = null;
    if (speechRecognitionSupported) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = "fr-FR";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        addMessage(transcript, "user-message");
        trackClick("VoiceInput", "Interaction", 0);
        simulateTyping(() => {
          const answer = getResponse(transcript);
          addMessage(answer, "bot-message");
        });
      };

      recognition.onend = () => {
        trackClick("VoiceStop", "Interaction", 0);
      };

      recognition.onerror = (event) => {
        addMessage("D√©sol√©, je n‚Äôai pas compris votre voix. Essayez encore.", "bot-message");
        trackClick("VoiceError", "Interaction", event.error);
      };
    }

    // Cacher le bouton vocal si la synth√®se vocale n'est pas support√©e
    if (!("speechSynthesis" in window)) {
      voiceToggle.style.display = "none";
    }
  </script>
</body>
</html>
